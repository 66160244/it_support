const pool = require("../config/database");

const UserModel = {
  // ðŸ§© CREATE â€” à¸ªà¸£à¹‰à¸²à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¹ƒà¸«à¸¡à¹ˆ
  async create({ username, email, password, role }) {
    const [result] = await pool.query(
      "INSERT INTO users (username, email, password, role) VALUES (?, ?, ?, ?)",
      [username, email, password, role]
    );
    return result.insertId;
  },

  // ðŸ” READ â€” à¸„à¹‰à¸™à¸«à¸²à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸”à¹‰à¸§à¸¢ username
  async findByUsername(username) {
    const [rows] = await pool.query("SELECT * FROM users WHERE username = ?", [username]);
    return rows[0];
  },

  // ðŸ” READ â€” à¸„à¹‰à¸™à¸«à¸²à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸”à¹‰à¸§à¸¢ email
  async findByEmail(email) {
    const [rows] = await pool.query("SELECT * FROM users WHERE email = ?", [email]);
    return rows[0];
  },

  // ðŸ” READ â€” à¸„à¹‰à¸™à¸«à¸²à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸”à¹‰à¸§à¸¢ id
  async findById(id) {
    const [rows] = await pool.query("SELECT id, username, email, role FROM users WHERE id = ?", [id]);
    return rows[0];
  },

  // ðŸ“œ READ â€” à¸”à¸¶à¸‡à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”
  async findAll() {
    const [rows] = await pool.query("SELECT id, username, email, role FROM users");
    return rows;
  },

  // âœï¸ UPDATE â€” à¸­à¸±à¸›à¹€à¸”à¸•à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰ (à¹„à¸¡à¹ˆà¸£à¸§à¸¡à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™)
  async updateUser(id, { username, email, role }) {
    const [result] = await pool.query(
      "UPDATE users SET username = ?, email = ?, role = ? WHERE id = ?",
      [username, email, role, id]
    );
    return result.affectedRows > 0;
  },

  // ðŸ”‘ UPDATE â€” à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¸£à¸«à¸±à¸ªà¸œà¹ˆà¸²à¸™à¹ƒà¸«à¸¡à¹ˆ
  async updatePassword(id, hashedPassword) {
    const [result] = await pool.query(
      "UPDATE users SET password = ? WHERE id = ?",
      [hashedPassword, id]
    );
    return result.affectedRows > 0;
  },

  // âŒ DELETE â€” à¸¥à¸šà¸œà¸¹à¹‰à¹ƒà¸Šà¹‰
  async deleteUser(id) {
    const [result] = await pool.query("DELETE FROM users WHERE id = ?", [id]);
    return result.affectedRows > 0;
  }
};

module.exports = UserModel;
